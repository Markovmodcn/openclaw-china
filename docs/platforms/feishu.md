# 📱 飞书配置指南

本指南将帮助你在飞书中配置 NexusBot 机器人。

---

## 📋 前置准备

- ✅ 已安装 NexusBot
- ✅ 拥有飞书企业管理员权限
- ✅ 已配置 AI 模型（本地或在线）

---

## 🚀 快速开始

### 第一步：创建飞书应用

1. **登录飞书开放平台**
   - 访问 [飞书开放平台](https://open.feishu.cn/)
   - 使用企业管理员账号登录

2. **创建企业自建应用**
   - 点击「创建企业自建应用」
   - 填写应用信息：
     - **应用名称**: NexusBot（或自定义）
     - **应用描述**: AI 智能助手
     - **应用图标**: 上传 logo

3. **获取应用凭证**
   - 进入应用详情页
   - 在「凭证与基础信息」中获取：
     - **App ID**
     - **App Secret**



### 第二步：配置应用权限

1. **添加机器人能力**
   - 在应用管理页面，点击「添加应用能力」
   - 选择「机器人」

2. **配置权限范围**
   - 进入「权限管理」
   - 添加以下权限：
     - ✅ `im:message` - 获取与发送单聊、群组消息
     - ✅ `im:message.group_at_msg` - 接收群聊中@机器人消息
     - ✅ `im:message.p2p_msg` - 接收单聊消息
     - ✅ `im:chat` - 获取群组信息

3. **申请权限**
   - 点击「申请权限」
   - 等待管理员审批（如果你是管理员，直接通过）

### 第三步：配置事件订阅

1. **启用事件订阅**
   - 进入「事件订阅」页面
   - 配置请求地址：`http://你的服务器IP:端口/feishu/webhook`
   - 示例：`http://192.168.1.100:3000/feishu/webhook`

2. **订阅事件**
   - 添加以下事件：
     - ✅ `im.message.receive_v1` - 接收消息
     - ✅ `im.message.message_read_v1` - 消息已读

3. **保存配置**
   - 点击「保存」并发布应用



### 第四步：在 NexusBot 中配置

1. **启动 NexusBot**
   - 双击桌面快捷方式启动

2. **进入飞书配置**
   - 点击左侧菜单「平台配置」
   - 选择「飞书」

3. **填写配置信息**
   ```
   App ID: 你的应用 App ID
   App Secret: 你的应用 App Secret
   Webhook 端口: 3000（默认）
   ```

4. **测试连接**
   - 点击「测试连接」按钮
   - 确认连接成功

5. **保存并启动**
   - 点击「保存配置」
   - 点击「启动服务」

---

## ✅ 验证配置

### 1. 添加机器人到群聊

1. 在飞书中创建一个测试群
2. 点击群设置 → 群机器人 → 添加机器人
3. 选择你创建的 NexusBot 应用

### 2. 测试对话

在群聊中 @机器人 发送消息：
```
@NexusBot 你好
```

机器人应该会回复你的消息。

### 3. 私聊测试

1. 在飞书中搜索你的机器人
2. 发起私聊
3. 发送消息测试

---

## 🔧 高级配置

### 自定义 Webhook 端口

如果默认端口 3000 被占用，可以修改：

1. 在 NexusBot 配置中修改端口号
2. 同时在飞书开放平台修改事件订阅地址
3. 重启 NexusBot 服务

### 配置消息卡片

飞书支持丰富的消息卡片格式，可以在 NexusBot 设置中启用：

- ✅ 文本消息
- ✅ 图片消息
- ✅ 文件消息
- ✅ 交互式卡片

---

## ❓ 常见问题



<details>
<summary><strong>Q: 机器人收不到消息怎么办？</strong></summary>

检查清单：
1. 确认 NexusBot 服务正在运行
2. 检查事件订阅地址是否正确
3. 确认权限已申请并通过
4. 查看 NexusBot 日志排查错误

</details>

<details>
<summary><strong>Q: 如何配置内网穿透？</strong></summary>

如果 NexusBot 运行在内网，需要配置内网穿透：

1. 使用 ngrok、frp 等工具
2. 将内网地址映射到公网
3. 在飞书开放平台配置公网地址

</details>

<details>
<summary><strong>Q: 支持哪些消息类型？</strong></summary>

当前支持：
- ✅ 文本消息
- ✅ 图片消息（接收）
- ✅ @提及
- 🚧 文件消息（开发中）
- 🚧 语音消息（开发中）

</details>

---

## 📚 相关文档

- [飞书开放平台文档](https://open.feishu.cn/document/)
- [NexusBot 快速开始](../quickstart.md)
- [常见问题](../faq.md)

---

## 💬 需要帮助？

- 🐛 [提交问题](https://github.com/Markovmodcn/openclaw-china/issues)
- 💬 加入微信用户群获取支持

