# 📱 企业微信配置指南

本指南将帮助你在企业微信中配置 NexusBot 机器人。

---

## 📋 前置准备

- ✅ 已安装 NexusBot
- ✅ 拥有企业微信管理员权限
- ✅ 已配置 AI 模型（本地或在线）

---

## 🚀 快速开始

### 第一步：创建企业微信应用

1. **登录企业微信管理后台**
   - 访问 [企业微信管理后台](https://work.weixin.qq.com/)
   - 使用管理员账号登录

2. **创建自建应用**
   - 进入「应用管理」→「应用」
   - 点击「创建应用」
   - 填写应用信息：
     - **应用名称**: NexusBot（或自定义）
     - **应用介绍**: AI 智能助手
     - **应用 Logo**: 上传图标

3. **获取应用凭证**
   - 创建完成后，进入应用详情
   - 记录以下信息：
     - **Corp ID**: 企业 ID
     - **Agent ID**: 应用 ID
     - **Secret**: 应用密钥



### 第二步：配置接收消息

1. **设置接收消息服务器**
   - 在应用详情页，找到「接收消息」配置
   - 点击「设置 API 接收」

2. **填写服务器配置**
   ```
   URL: http://你的服务器IP:端口/wecom/webhook
   Token: 自定义 Token（建议随机生成）
   EncodingAESKey: 点击「随机获取」
   ```
   - 示例 URL: `http://192.168.1.100:3000/wecom/webhook`

3. **保存配置**
   - 点击「保存」
   - 企业微信会发送验证请求，NexusBot 会自动响应

### 第三步：配置应用权限

1. **设置可见范围**
   - 在应用详情页，找到「可见范围」
   - 添加需要使用机器人的部门或成员

2. **配置应用权限**
   - 确保以下权限已启用：
     - ✅ 发送消息到企业
     - ✅ 接收消息
     - ✅ 通讯录管理（可选）



### 第四步：在 NexusBot 中配置

1. **启动 NexusBot**
   - 双击桌面快捷方式启动

2. **进入企业微信配置**
   - 点击左侧菜单「平台配置」
   - 选择「企业微信」

3. **填写配置信息**
   ```
   Corp ID: 你的企业 ID
   Agent ID: 你的应用 ID
   Secret: 你的应用密钥
   Token: 你设置的 Token
   EncodingAESKey: 你获取的 AESKey
   Webhook 端口: 3000（默认）
   ```

4. **测试连接**
   - 点击「测试连接」按钮
   - 确认连接成功

5. **保存并启动**
   - 点击「保存配置」
   - 点击「启动服务」

---

## ✅ 验证配置

### 1. 在企业微信中找到应用

1. 打开企业微信客户端
2. 进入「工作台」
3. 找到你创建的 NexusBot 应用

### 2. 测试对话

点击应用进入聊天界面，发送消息：
```
你好
```

机器人应该会回复你的消息。

### 3. 群聊测试

1. 创建一个企业微信群
2. 在群聊中 @机器人
3. 发送消息测试

---

## 🔧 高级配置

### 主动发送消息

企业微信支持机器人主动发送消息给用户：

1. 在 NexusBot 中启用「主动消息」功能
2. 配置消息推送规则
3. 可用于定时提醒、任务通知等场景

### 配置消息模板

企业微信支持多种消息类型：

- ✅ 文本消息
- ✅ 图片消息
- ✅ 文件消息
- ✅ 图文消息
- ✅ Markdown 消息

### 配置应用菜单

可以为应用配置自定义菜单：

1. 在企业微信管理后台配置菜单
2. 支持跳转链接、发送消息等操作

---

## ❓ 常见问题

<details>
<summary><strong>Q: 机器人收不到消息怎么办？</strong></summary>

检查清单：
1. 确认 NexusBot 服务正在运行
2. 检查 Webhook URL 是否正确配置
3. 确认 Token 和 EncodingAESKey 配置正确
4. 检查应用可见范围是否包含测试用户
5. 查看 NexusBot 日志排查错误

</details>

<details>
<summary><strong>Q: 如何配置内网穿透？</strong></summary>

如果 NexusBot 运行在内网，需要配置内网穿透：

1. 使用 ngrok、frp、花生壳等工具
2. 将内网地址映射到公网
3. 在企业微信管理后台配置公网地址
4. 确保公网地址可以访问

</details>

<details>
<summary><strong>Q: 支持哪些消息类型？</strong></summary>

当前支持：
- ✅ 文本消息
- ✅ 图片消息
- ✅ 文件消息（接收）
- ✅ @提及
- ✅ 主动发送消息
- 🚧 语音消息（开发中）

</details>

<details>
<summary><strong>Q: 企业微信和个人微信有什么区别？</strong></summary>

- 企业微信是企业办公平台，需要企业认证
- 个人微信不支持机器人 API
- NexusBot 只支持企业微信，不支持个人微信

</details>

---

## 📚 相关文档

- [企业微信开发文档](https://developer.work.weixin.qq.com/)
- [NexusBot 快速开始](../quickstart.md)
- [常见问题](../faq.md)

---

## 💬 需要帮助？

- 🐛 [提交问题](https://github.com/Markovmodcn/openclaw-china/issues)
- 💬 加入微信用户群获取支持

